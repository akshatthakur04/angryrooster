<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Help Shape The Drop | Angry Rooster</title>
  <link rel="preconnect" href="https://fonts.googleapis.com" />
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&family=Bebas+Neue&display=swap" rel="stylesheet" />
  <link rel="icon" type="image/svg+xml" href="../logo.svg" />
  <link rel="stylesheet" href="../css/styles.css" />
  <style>
    :root {
      --ink:#0a0a0a; --muted:#666; --border:rgba(0,0,0,0.08); --bg:#ffffff; --accent:#111;--ring:rgba(0,0,0,0.25);
      --radius:14px; --space-1:6px; --space-2:10px; --space-3:14px; --space-4:18px; --space-5:22px; --space-6:28px;
    }
    * { box-sizing: border-box }
    body { background:#fff; color:#000; font-family: Inter, system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial, "Apple Color Emoji", "Segoe UI Emoji"; }
    .page { padding-top: 120px; padding-bottom: 80px; position: relative; }
    .wrap { max-width: 880px; margin: 0 auto; padding: 0 20px; }

    /* Page ambiance */
    .page::before {
      content: ""; position: absolute; inset: 0; pointer-events: none;
      background:
        radial-gradient(60% 40% at 50% -10%, rgba(0,0,0,0.06), transparent 60%),
        radial-gradient(40% 30% at 80% 10%, rgba(0,0,0,0.04), transparent 70%);
    }

    /* Make navbar dark on this white page for logo visibility */
    #navbar { background: rgba(0,0,0,0.85); backdrop-filter: blur(16px) saturate(140%); border-bottom: 1px solid rgba(255,255,255,0.08); }
    #navbar .nav-link { color:#fff; text-shadow: 0 1px 2px rgba(0,0,0,0.4); }
    #navbar .logo { filter: invert(1) brightness(1.8); }

    .page-eyebrow { display:inline-flex; align-items:center; gap:8px; font-size:11px; letter-spacing:1.2px; text-transform:uppercase; color:#444; background:#f5f5f5; border:1px solid var(--border); padding:6px 10px; border-radius:999px }
    .page-title { font-family:'Bebas Neue', cursive; font-size: clamp(2.2rem,5vw,3.6rem); letter-spacing:2px; margin: 10px 0 6px; line-height: 0.95; position: relative; }
    .page-title::after { content:""; display:block; height:2px; width:72px; margin-top:10px; background: linear-gradient(90deg, #000, rgba(0,0,0,0)); opacity:.15 }
    .page-sub { font-size: 14px; color:#555; line-height:1.7; margin: 0 0 22px; }

    .panel { position:relative; background:#fff; border:1px solid var(--border); border-radius: var(--radius); padding: var(--space-6); box-shadow: 0 12px 36px rgba(0,0,0,0.05); overflow: hidden; }
    .panel::before { /* subtle gradient border glow */
      content:""; position:absolute; inset:0; border-radius: inherit; padding:1px;
      background: linear-gradient(120deg, rgba(0,0,0,0.12), rgba(0,0,0,0.02));
      -webkit-mask: linear-gradient(#000 0 0) content-box, linear-gradient(#000 0 0);
      -webkit-mask-composite: xor; mask-composite: exclude; pointer-events:none;
    }

    .row { display:grid; grid-template-columns: 1fr 1fr; gap: var(--space-3); }
    .row--3 { grid-template-columns: repeat(3, 1fr); }
    .field { display:flex; flex-direction:column; gap:8px; }
    .label { font-size:12px; font-weight:600; letter-spacing:1px; text-transform:uppercase; color:#222; }
    .help { font-size:12px; color:#777; }

    .input, .select, .textarea { width:100%; padding: 14px; border:1px solid var(--border); border-radius:12px; font-size:14px; background:#fafafa; transition: border-color .2s ease, background .2s ease, box-shadow .2s ease; }
    .input:hover, .select:hover, .textarea:hover { border-color: rgba(0,0,0,0.18); }
    .input:focus, .select:focus, .textarea:focus { outline:none; border-color: var(--ring); background:#fff; box-shadow: 0 4px 16px rgba(0,0,0,0.06); }
    .input[aria-invalid="true"], .select[aria-invalid="true"], .textarea[aria-invalid="true"] { border-color:#b91c1c }
    .error-text { color:#b91c1c; font-size:12px }
    .textarea { min-height: 160px; resize: vertical; }
    .counter { font-size:12px; color:#777; text-align:right; }

    .segmented { display:flex; gap:8px; flex-wrap:wrap }
    .segmented input { display:none }
    .segmented label { user-select:none; padding:10px 12px; border:1px solid var(--border); border-radius:10px; font-size:13px; cursor:pointer; background:#fafafa; transition:all .15s ease }
    .segmented input:checked + label { background:#111; color:#fff; border-color:#111 }
    .segmented label:hover { transform: translateY(-1px) }

    .stars { display:flex; gap:8px; align-items:center; }
    .star-input { display:none; }
    .star { width:34px; height:34px; display:inline-flex; align-items:center; justify-content:center; border:1px solid var(--border); border-radius:10px; cursor:pointer; background:#fafafa; transition:all .2s ease; position:relative; overflow:hidden }
    .star svg { width:18px; height:18px; color:#bbb; transition: color .2s ease; z-index:1 }
    .star::after { content:""; position:absolute; inset:0; background: radial-gradient(60% 60% at 50% 50%, rgba(0,0,0,0.08), transparent); opacity:0; transition: opacity .2s ease }
    .star:hover { border-color:#111; background:#fff; }
    .star:hover::after { opacity:1 }
    .star-input:checked + .star svg { color:#111; }

    .nps { display:flex; flex-direction:column; gap:8px }
    .nps .scale { display:flex; align-items:center; gap:6px }
    .nps input[type="range"] { width:100% }
    .nps .ticks { display:flex; justify-content:space-between; font-size:11px; color:#777 }

    .conditional { display:none }
    .conditional.show { display:grid }

    .actions { margin-top: var(--space-4); display:flex; gap:10px; align-items:center; flex-wrap:wrap }
    .btn { position:relative; padding:14px 18px; border-radius:12px; border:1px solid rgba(0,0,0,0.2); background:#0a0a0a; color:#fff; font-size:12px; font-weight:700; letter-spacing:1.5px; text-transform:uppercase; cursor:pointer; transition:transform .2s ease, box-shadow .2s ease, background .2s ease; overflow:hidden }
    .btn:hover { transform: translateY(-1px); box-shadow:0 8px 24px rgba(0,0,0,0.15); }
    .btn::after { content:""; position:absolute; inset:-2px; background: linear-gradient(120deg, transparent 30%, rgba(255,255,255,0.24) 50%, transparent 70%); transform: translateX(-120%); transition: transform .5s ease; }
    .btn:hover::after { transform: translateX(120%); }
    .btn[disabled] { opacity:.6; cursor:not-allowed; transform:none; }
    .btn .spinner { position:absolute; left:12px; top:50%; transform:translateY(-50%); display:none }
    .btn.loading .spinner { display:inline-block }

    .status { font-size:12px; color:#444; min-height:18px; }
    .status.success { color:#15803d; }
    .status.error { color:#b91c1c; }

    .aside { margin-top: var(--space-4); font-size:12px; color:#666; }

    .toast { position: fixed; bottom: 18px; right: 18px; background:#111; color:#fff; padding:12px 14px; border-radius:12px; box-shadow: 0 12px 30px rgba(0,0,0,.2); font-size:13px; display:none }
    .toast.show { display:block }

    .visually-hidden { position:absolute !important; width:1px; height:1px; padding:0; margin:-1px; overflow:hidden; clip:rect(0, 0, 0, 0); white-space:nowrap; border:0; }

    /* Better keyboard focus */
    :is(.input,.select,.textarea,.star,.segmented label,.btn):focus-visible {
      outline: 2px solid #111; outline-offset: 2px;
    }

    @media (max-width: 820px) {
      .page { padding-top: 110px; padding-bottom: 60px; }
      .row, .row--3 { grid-template-columns: 1fr; }
      .actions { flex-direction: column; align-items: stretch; }
      .btn { width: 100%; }
    }
  </style>
</head>
<body>
    <!-- Loading Screen -->
    <div class="loading-screen" id="loadingScreen">
        <div class="loading-logo">
            <img src="../logo.svg" alt="Angry Rooster">
            <div class="loading-bar"></div>
        </div>
    </div>

    <!-- Nav -->
  <nav class="navbar" id="navbar">
    <div class="nav-container">
      <div class="nav-left">
        <a href="../main.html" class="nav-link">Home</a>
        <a href="about.html" class="nav-link">About</a>
      </div>
      <div class="nav-center">
        <a href="../main.html" class="logo-link"><img src="../logo.svg" alt="Angry Rooster" class="logo" /></a>
      </div>
      <div class="nav-right">
        <a href="performance.html" class="nav-link">Products</a>
      </div>
    </div>
  </nav>

  <main class="page">
    <div class="wrap">
      <span class="page-eyebrow">Community feedback</span>
      <header>
        <h1 class="page-title">Help shape the next drop</h1>
        <p class="page-sub">No corporate black hole. We read every submission and use it to tweak materials, fit and delivery. Leave a way to contact you if you want a reply.</p>
      </header>

      <section class="panel" aria-labelledby="feedbackTitle">
        <h2 id="feedbackTitle" class="visually-hidden">Feedback Form</h2>
        <form id="feedbackForm" novalidate>
          <input type="text" id="company" name="company" autocomplete="organization" tabindex="-1" aria-hidden="true" class="visually-hidden" />

          <div class="row">
            <div class="field">
              <label for="name" class="label">Name <span class="help">(optional)</span></label>
              <input id="name" name="name" type="text" class="input" autocomplete="name" />
            </div>
            <div class="field">
              <label for="email" class="label">Email <span class="help">(optional)</span></label>
              <input id="email" name="email" type="email" class="input" autocomplete="email" placeholder="we’ll only use this to reply" />
            </div>
          </div>

          <div class="field" role="radiogroup" aria-label="Type of feedback">
            <span class="label">Type of feedback</span>
            <div class="segmented" id="typeSegmented">
              <input type="radio" id="t1" name="type" value="Product Quality"><label for="t1">Product Quality</label>
              <input type="radio" id="t2" name="type" value="Fit & Sizing"><label for="t2">Fit & Sizing</label>
              <input type="radio" id="t3" name="type" value="Website Experience"><label for="t3">Website</label>
              <input type="radio" id="t4" name="type" value="Delivery"><label for="t4">Delivery</label>
              <input type="radio" id="t5" name="type" value="Other"><label for="t5">Other</label>
            </div>
            <div id="typeError" class="error-text" style="display:none">Pick one.</div>
          </div>

          <div class="row">
            <div class="field">
              <label class="label">Overall rating</label>
              <div class="stars" role="radiogroup" aria-label="Rating">
                <input class="star-input" type="radio" name="rating" id="r1" value="1">
                <label for="r1" class="star" aria-label="1 star"><svg viewBox="0 0 24 24" fill="currentColor"><path d="M12 17.27 18.18 21l-1.64-7.03L22 9.24l-7.19-.61L12 2 9.19 8.63 2 9.24l5.46 4.73L5.82 21z"/></svg></label>
                <input class="star-input" type="radio" name="rating" id="r2" value="2">
                <label for="r2" class="star" aria-label="2 stars"><svg viewBox="0 0 24 24" fill="currentColor"><path d="M12 17.27 18.18 21l-1.64-7.03L22 9.24l-7.19-.61L12 2 9.19 8.63 2 9.24l5.46 4.73L5.82 21z"/></svg></label>
                <input class="star-input" type="radio" name="rating" id="r3" value="3">
                <label for="r3" class="star" aria-label="3 stars"><svg viewBox="0 0 24 24" fill="currentColor"><path d="M12 17.27 18.18 21l-1.64-7.03L22 9.24l-7.19-.61L12 2 9.19 8.63 2 9.24l5.46 4.73L5.82 21z"/></svg></label>
                <input class="star-input" type="radio" name="rating" id="r4" value="4">
                <label for="r4" class="star" aria-label="4 stars"><svg viewBox="0 0 24 24" fill="currentColor"><path d="M12 17.27 18.18 21l-1.64-7.03L22 9.24l-7.19-.61L12 2 9.19 8.63 2 9.24l5.46 4.73L5.82 21z"/></svg></label>
                <input class="star-input" type="radio" name="rating" id="r5" value="5" checked>
                <label for="r5" class="star" aria-label="5 stars"><svg viewBox="0 0 24 24" fill="currentColor"><path d="M12 17.27 18.18 21l-1.64-7.03L22 9.24l-7.19-.61L12 2 9.19 8.63 2 9.24l5.46 4.73L5.82 21z"/></svg></label>
              </div>
            </div>

            <div class="field nps">
              <label for="nps" class="label">Would you recommend us to a friend? <span class="help">(0 = no chance, 10 = absolutely)</span></label>
              <div class="scale">
                <span>0</span>
                <input type="range" min="0" max="10" step="1" id="nps" name="nps" value="10" />
                <span>10</span>
              </div>
              <div class="ticks"><span>Not at all</span><span>Neutral</span><span>Absolutely</span></div>
            </div>
          </div>

          <!-- Conditional blocks -->
          <div id="cond-sizing" class="conditional row">
            <div class="field">
              <label for="size" class="label">What size did you buy?</label>
              <select id="size" class="select">
                <option value="">Select size</option>
                <option>XS</option><option>S</option><option>M</option><option>L</option><option>XL</option><option>XXL</option>
              </select>
            </div>
            <div class="field">
              <label for="fitPref" class="label">How did it fit?</label>
              <select id="fitPref" class="select">
                <option value="">Select one</option>
                <option>Too tight</option>
                <option>Just right</option>
                <option>Too relaxed</option>
                <option>Too long</option>
                <option>Too short</option>
              </select>
            </div>
          </div>

          <div id="cond-delivery" class="conditional row">
            <div class="field">
              <label for="order" class="label">Order number <span class="help">(optional)</span></label>
              <input id="order" type="text" class="input" placeholder="#AR-12345" />
            </div>
            <div class="field">
              <label for="carrier" class="label">Issue</label>
              <select id="carrier" class="select">
                <option value="">Select one</option>
                <option>Late delivery</option>
                <option>Damaged item</option>
                <option>Lost parcel</option>
                <option>Wrong item</option>
              </select>
            </div>
          </div>

          <div id="cond-website" class="conditional row">
            <div class="field">
              <label for="device" class="label">Device</label>
              <select id="device" class="select">
                <option value="">Select one</option>
                <option>Mobile</option>
                <option>Desktop</option>
                <option>Tablet</option>
              </select>
            </div>
            <div class="field">
              <label for="browser" class="label">Browser <span class="help">(optional)</span></label>
              <input id="browser" type="text" class="input" placeholder="Safari, Chrome, Edge…" />
            </div>
          </div>

          <div class="field">
            <label for="message" class="label">Message</label>
            <textarea id="message" name="message" class="textarea" maxlength="800" placeholder="Be honest. What should we tweak, improve, or build next?" required></textarea>
            <div class="counter" id="counter">0 / 800</div>
            <div id="messageError" class="error-text" style="display:none">Give us a little detail (10+ characters).</div>
          </div>

          <div class="field">
            <label class="label" for="consent">
              <input type="checkbox" id="consent" />
              It’s okay to contact me about this feedback.
            </label>
          </div>

          <div class="actions">
            <button id="sendBtn" type="submit" class="btn">
              <span class="spinner" aria-hidden>⏳</span>
              <span class="text">Send Feedback</span>
            </button>
            <div id="status" class="status" aria-live="polite"></div>
          </div>
        </form>
        <p class="aside">We use anonymised analytics to spot trends. No spam, ever.</p>
      </section>
    </div>
  </main>

  <div id="toast" class="toast" role="status" aria-live="polite">Saved. Thank you.</div>

  <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
  <script src="../js/supabase-config.local.js"></script>
  <script>
    // Global loader handles timing; no per-page loader code here
    // --- Elements
    const form = document.getElementById('feedbackForm');
    const messageEl = document.getElementById('message');
    const counterEl = document.getElementById('counter');
    const statusEl = document.getElementById('status');
    const sendBtn = document.getElementById('sendBtn');
    const toast = document.getElementById('toast');

    const typeRadios = Array.from(document.querySelectorAll('input[name="type"]'));
    const condSizing = document.getElementById('cond-sizing');
    const condDelivery = document.getElementById('cond-delivery');
    const condWebsite = document.getElementById('cond-website');

    // --- Character counter
    messageEl.addEventListener('input', () => {
      counterEl.textContent = `${messageEl.value.length} / ${messageEl.maxLength}`;
    });

    // --- Segmented conditional logic
    function updateConditionals() {
      const checked = typeRadios.find(r => r.checked)?.value;
      condSizing.classList.toggle('show', checked === 'Fit & Sizing');
      condDelivery.classList.toggle('show', checked === 'Delivery');
      condWebsite.classList.toggle('show', checked === 'Website Experience');
    }
    typeRadios.forEach(r => r.addEventListener('change', () => { hideError('type'); updateConditionals(); }));

    // --- Helpers
    function getRating() { const el = document.querySelector('input[name="rating"]:checked'); return el ? Number(el.value) : null; }
    function showError(field) {
      if (field === 'type') { document.getElementById('typeError').style.display = 'block'; }
      if (field === 'message') { document.getElementById('messageError').style.display = 'block'; messageEl.setAttribute('aria-invalid','true'); }
    }
    function hideError(field) {
      if (field === 'type') { document.getElementById('typeError').style.display = 'none'; }
      if (field === 'message') { document.getElementById('messageError').style.display = 'none'; messageEl.setAttribute('aria-invalid','false'); }
    }
    function setLoading(loading) { sendBtn.classList.toggle('loading', loading); sendBtn.disabled = loading; }
    function showToast(text) { toast.textContent = text; toast.classList.add('show'); setTimeout(()=>toast.classList.remove('show'), 2500); }

    // --- Local queue fallback
    const LOCAL_KEY = 'ar_feedback_queue_v1';
    function enqueueLocal(payload) {
      const q = JSON.parse(localStorage.getItem(LOCAL_KEY) || '[]');
      q.push(payload); localStorage.setItem(LOCAL_KEY, JSON.stringify(q));
    }

    async function flushQueue() {
      if (typeof supabaseClient === 'undefined') return;
      const q = JSON.parse(localStorage.getItem(LOCAL_KEY) || '[]');
      if (!q.length) return;
      try {
        const { error } = await supabaseClient.from('user_feedback').insert(q);
        if (!error) { localStorage.removeItem(LOCAL_KEY); showToast('Synced pending feedback. Thanks!'); }
      } catch(e) { /* ignore */ }
    }

    window.addEventListener('load', flushQueue);

    // --- Submit
    form.addEventListener('submit', async (e) => {
      e.preventDefault();
      statusEl.className = 'status';
      statusEl.textContent = '';

      // Honeypot (basic spam trap)
      const hp = document.getElementById('company').value.trim();
      if (hp) { showToast('Saved. Thank you!'); form.reset(); counterEl.textContent = '0 / 800'; return; }

      const type = typeRadios.find(r => r.checked)?.value || '';
      const msg = messageEl.value.trim();

      if (!type) { showError('type'); return; }
      if (!msg || msg.length < 10) { showError('message'); return; }

      const payload = {
        name: document.getElementById('name').value.trim() || null,
        email: document.getElementById('email').value.trim() || null,
        type,
        message: msg,
        rating: getRating(),
        nps: Number(document.getElementById('nps').value),
        consent: document.getElementById('consent').checked,
        created_at: new Date().toISOString(),
        // Optional structured meta (ensure JSONB column `meta` exists)
        meta: {
          size: document.getElementById('size')?.value || null,
          fitPref: document.getElementById('fitPref')?.value || null,
          order: document.getElementById('order')?.value || null,
          issue: document.getElementById('carrier')?.value || null,
          device: document.getElementById('device')?.value || null,
          browser: document.getElementById('browser')?.value || null,
        }
      };

      try {
        setLoading(true);
        statusEl.textContent = 'Sending...';

        if (typeof supabaseClient === 'undefined') {
          enqueueLocal(payload);
          statusEl.textContent = 'Saved locally. Connect Supabase to sync.';
          statusEl.classList.add('success');
          form.reset(); counterEl.textContent = '0 / 800'; updateConditionals();
          return;
        }

        const { error } = await supabaseClient
          .from('user_feedback')
          .insert(payload);

        if (error) throw error;

        statusEl.textContent = 'Got it. Thanks for helping us level up.';
        statusEl.classList.add('success');
        showToast('Feedback sent');
        try { window.plausible && window.plausible('Feedback Submitted', { props: { type: payload.type, rating: payload.rating } }); } catch(_){}
        form.reset();
        counterEl.textContent = '0 / 800';
        updateConditionals();
      } catch (err) {
        statusEl.textContent = 'Could not send feedback. Saved locally and will retry.';
        statusEl.classList.add('error');
        enqueueLocal(payload);
      } finally {
        setLoading(false);
      }
    });

    // Init
    updateConditionals();
  </script>
  <script src="../js/main.js"></script>
</body>
</html>